<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>RS Stocks Table</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap4.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container-fluid">
    <main class="row">
      <div class="col">
        <h1>RS Stocks Table</h1>
        <p>Interactive table displaying stock data from RS_Data/rs_stocks.csv with search, sort, and multiple filters.</p>
        <div class="filter-row row mb-3">
          <div class="col-md-4">
            <div class="form-group">
              <label for="ticker-filter">Filter by Ticker:</label>
              <select id="ticker-filter" class="form-control custom-select">
                <option value="">All Tickers</option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label for="sector-filter">Filter by Sector:</label>
              <select id="sector-filter" class="form-control custom-select">
                <option value="">All Sectors</option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label for="industry-filter">Filter by Industry:</label>
              <select id="industry-filter" class="form-control custom-select">
                <option value="">All Industries</option>
              </select>
            </div>
          </div>
        </div>
        <div id="table-container"></div>
      </div>
    </main>
    <footer class="row">
      <div class="col">
        <hr>
        <p class="text-right">Created by <a href="https://github.com/Vinubhai1961">Vinubhai1961</a></p>
      </div>
    </footer>
  </div>
  <!-- JavaScript Dependencies -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script src="js/jquery.csv.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>
  <script src="js/csv_to_html_table.js"></script>
  <script>
    // Custom formatting functions
    function format_currency(value) {
      if (value && !isNaN(value)) {
        return `$${parseFloat(value).toFixed(2)}`;
      }
      return "";
    }
    function format_percent(value) {
      if (value && !isNaN(value)) {
        return `${parseFloat(value).toFixed(1)}%`;
      }
      return "";
    }
    function format_large_number(value) {
      if (value && !isNaN(value)) {
        const num = parseFloat(value);
        if (num >= 1e9) return (num / 1e9).toFixed(2) + "B";
        if (num >= 1e6) return (num / 1e6).toFixed(2) + "M";
        return num.toLocaleString();
      }
      return "";
    }
    function format_ipo(value) {
      return value === "Yes" ? "Yes" : "No";
    }

    // Initialize table
    CsvToHtmlTable.init({
      csv_path: "RS_Data/rs_stocks.csv",
      element: "table-container",
      allow_download: true,
      csv_options: { separator: ",", delimiter: '"' },
      datatables_options: {
        paging: true,
        pageLength: 25,
        ordering: true,
        searching: true,
        deferRender: true,
        columnDefs: [
          { targets: [0, 3, 10, 11], type: "num" },
          { targets: [2, 12, 13], type: "num-fmt" },
          { targets: [6, 7, 8, 9], type: "num-fmt" }
        ]
      },
      custom_formatting: [
        [2, format_currency],
        [3, format_large_number],
        [6, format_percent],
        [7, format_percent],
        [8, format_percent],
        [9, format_percent],
        [10, format_large_number],
        [11, format_large_number],
        [12, format_currency],
        [13, format_currency],
        [14, format_large_number],
        [15, format_ipo]
      ]
    });

    // Populate and handle filters
    $(document).ready(function() {
      const table = $('#table-container table').DataTable();
      // Ticker filter
      table.column(1).data().unique().sort().each(function(value) {
        if (value) {
          $('#ticker-filter').append(`<option value="${value}">${value}</option>`);
        }
      });
      $('#ticker-filter').on('change', function() {
        const val = $.fn.dataTable.util.escapeRegex($(this).val());
        table.column(1).search(val ? '^' + val + '$' : '', true, false).draw();
      });
      // Sector filter
      table.column(4).data().unique().sort().each(function(value) {
        if (value) {
          $('#sector-filter').append(`<option value="${value}">${value}</option>`);
        }
      });
      $('#sector-filter').on('change', function() {
        const val = $.fn.dataTable.util.escapeRegex($(this).val());
        table.column(4).search(val ? '^' + val + '$' : '', true, false).draw();
      });
      // Industry filter
      table.column(5).data().unique().sort().each(function(value) {
        if (value) {
          $('#industry-filter').append(`<option value="${value}">${value}</option>`);
        }
      });
      $('#industry-filter').on('change', function() {
        const val = $.fn.dataTable.util.escapeRegex($(this).val());
        table.column(5).search(val ? '^' + val + '$' : '', true, false).draw();
      });
    });
  </script>
</body>
</html>
